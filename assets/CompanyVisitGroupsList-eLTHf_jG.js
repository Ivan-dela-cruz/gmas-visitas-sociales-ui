import{r as h,q as se,R as r,t as ae,P as z,j as e,k as p,C as S,S as E,v as B,Q as V,m as te,U as X,V as Y,W as _,X as R,B as C,O as K,Y as ee,F,A as j,H as re,J as ne,K as J,Z as oe,$ as le,a0 as ie,a1 as ce,w as de,y as me,M as pe}from"./index-C1pIq2vl.js";import{u as ge,d as he}from"./companyVisitGroups-BFwJnGL6.js";import{C as G}from"./Checkbox-BVDf5dAw.js";import{E as ue}from"./Edit-ByxEqKd5.js";import{T as H,u as P,C as $}from"./useConfirmDialog-Brskm5sG.js";import{B as Z}from"./index-3EovK7LH.js";import{u as xe,a as ye,b as fe,c as je,d as ve,e as Ce,f as be}from"./userCompanyVisitGroups-iFn3Fi9t.js";import{C as U}from"./CircularProgress-DEhu9n-n.js";import{u as ke}from"./users-DtXYsbxr.js";import{I as Ae}from"./InputLabel-Bx_DgBK8.js";import"./ArrowLeft-REL-uIIU.js";import"./TextField-BpgFI3H7.js";import"./FormHelperText-DKDoT4uR.js";var Ee=["variant","color","size"],Se=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{d:"M12 15c-5.01 0-9.09 3.36-9.09 7.5 0 .28.22.5.5.5h17.18c.28 0 .5-.22.5-.5 0-4.14-4.08-7.5-9.09-7.5ZM15.71 3.66A4.948 4.948 0 0 0 12 2c-1.4 0-2.68.57-3.59 1.51C7.54 4.41 7 5.65 7 7c0 .94.26 1.82.73 2.57.25.43.57.82.95 1.14.87.8 2.03 1.29 3.32 1.29 1.83 0 3.41-.98 4.28-2.43.26-.43.46-.91.57-1.41.1-.37.15-.76.15-1.16 0-1.28-.49-2.45-1.29-3.34Zm-1.84 4.26h-.93v.97a.939.939 0 1 1-1.88 0v-.97h-.93a.939.939 0 1 1 0-1.88h.93v-.89a.939.939 0 1 1 1.88 0v.89h.93a.939.939 0 1 1 0 1.88Z",fill:s}))},we=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{d:"M15.02 3.01A4.944 4.944 0 0 0 12 2C9.24 2 7 4.24 7 7s2.24 5 5 5 5-2.24 5-5M3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:s,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.492 17.98h-2.98M18 16.52v2.99",stroke:s,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},Te=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{opacity:".4",d:"M21.09 21.5c0 .28-.22.5-.5.5H3.41c-.28 0-.5-.22-.5-.5 0-4.14 4.08-7.5 9.09-7.5 1.03 0 2.03.14 2.95.41-.59.7-.95 1.61-.95 2.59 0 .75.21 1.46.58 2.06.2.34.46.65.76.91.7.64 1.63 1.03 2.66 1.03 1.12 0 2.13-.46 2.85-1.2.16.54.24 1.11.24 1.7Z",fill:s}),r.createElement("path",{d:"M20.97 14.33A3.944 3.944 0 0 0 18 13a3.995 3.995 0 0 0-4 4c0 .75.21 1.46.58 2.06.2.34.46.65.76.91.7.64 1.63 1.03 2.66 1.03 1.46 0 2.73-.78 3.42-1.94.21-.34.37-.73.46-1.13.08-.3.12-.61.12-.93 0-1.02-.39-1.96-1.03-2.67Zm-1.47 3.4h-.75v.78c0 .41-.34.75-.75.75s-.75-.34-.75-.75v-.78h-.75c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h.75v-.71c0-.41.34-.75.75-.75s.75.34.75.75v.71h.75c.41 0 .75.34.75.75s-.34.75-.75.75ZM12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",fill:s}))},Q=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{d:"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10ZM3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:s,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.49 17.98h-2.98M18 16.52v2.99",stroke:s,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},Ie=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{d:"M12 12.75c-3.17 0-5.75-2.58-5.75-5.75S8.83 1.25 12 1.25 17.75 3.83 17.75 7s-2.58 5.75-5.75 5.75Zm0-10A4.26 4.26 0 0 0 7.75 7 4.26 4.26 0 0 0 12 11.25 4.26 4.26 0 0 0 16.25 7 4.26 4.26 0 0 0 12 2.75ZM3.41 22.75c-.41 0-.75-.34-.75-.75 0-4.27 4.19-7.75 9.34-7.75 1.01 0 2 .13 2.96.4.4.11.63.52.52.92-.11.4-.52.63-.92.52-.82-.23-1.68-.34-2.56-.34-4.32 0-7.84 2.8-7.84 6.25 0 .41-.34.75-.75.75Z",fill:s}),r.createElement("path",{d:"M18 22.75a4.7 4.7 0 0 1-3.17-1.23c-.35-.3-.66-.67-.9-1.08-.44-.72-.68-1.57-.68-2.44 0-1.25.48-2.42 1.34-3.31.9-.93 2.11-1.44 3.41-1.44 1.36 0 2.65.58 3.53 1.58A4.74 4.74 0 0 1 22.75 18c0 .38-.05.76-.15 1.12-.1.45-.29.92-.55 1.33-.83 1.42-2.39 2.3-4.05 2.3Zm0-8a3.241 3.241 0 0 0-2.78 4.92c.16.28.37.53.61.74.6.55 1.37.85 2.17.85 1.13 0 2.2-.6 2.78-1.57.17-.28.3-.6.37-.91.07-.26.1-.51.1-.77 0-.8-.3-1.57-.84-2.17-.6-.7-1.48-1.09-2.41-1.09Z",fill:s}),r.createElement("path",{d:"M19.498 18.73h-2.99c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h2.99c.41 0 .75.34.75.75s-.34.75-.75.75Z",fill:s}),r.createElement("path",{d:"M18 20.26c-.41 0-.75-.34-.75-.75v-2.99c0-.41.34-.75.75-.75s.75.34.75.75v2.99c0 .42-.34.75-.75.75Z",fill:s}))},Ne=function(i){var s=i.color;return r.createElement(r.Fragment,null,r.createElement("path",{d:"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",stroke:s,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{opacity:".4",d:"M3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:s,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),r.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.492 17.98h-2.98M18 16.52v2.99",stroke:s,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},Le=function(i,s){switch(i){case"Bold":return r.createElement(Se,{color:s});case"Broken":return r.createElement(we,{color:s});case"Bulk":return r.createElement(Te,{color:s});case"Linear":return r.createElement(Q,{color:s});case"Outline":return r.createElement(Ie,{color:s});case"TwoTone":return r.createElement(Ne,{color:s});default:return r.createElement(Q,{color:s})}},W=h.forwardRef(function(l,i){var s=l.variant,u=l.color,n=l.size,o=se(l,Ee);return r.createElement("svg",ae({},o,{xmlns:"http://www.w3.org/2000/svg",ref:i,width:n,height:n,viewBox:"0 0 24 24",fill:"none"}),Le(s,u))});W.propTypes={variant:z.oneOf(["Linear","Bold","Broken","Bulk","Outline","TwoTone"]),color:z.string,size:z.oneOfType([z.string,z.number])};W.defaultProps={variant:"Linear",color:"currentColor",size:"24"};W.displayName="UserAdd";function De({onEdit:l,onDelete:i,onAssignEmployees:s,onAssignUsers:u}){return[{id:"select",header:({table:n})=>e.jsx(G,{checked:n.getIsAllPageRowsSelected(),indeterminate:n.getIsSomePageRowsSelected(),onChange:o=>{n.getToggleAllPageRowsSelectedHandler()(o)},sx:{padding:0}}),cell:({row:n})=>e.jsx(G,{checked:n.getIsSelected(),disabled:!n.getCanSelect(),onChange:o=>{n.getToggleSelectedHandler()(o)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Código",accessorKey:"code",cell:({getValue:n})=>{const o=n();return e.jsx(p,{variant:"body2",sx:{fontWeight:600},children:o||"N/A"})}},{header:"Nombre",accessorKey:"name",cell:({row:n,getValue:o})=>{const g=o(),m=()=>l==null?void 0:l(n.original);return e.jsx(p,{variant:"body2",component:"a",onClick:m,sx:{color:"primary.main",textDecoration:"none",cursor:"pointer",fontWeight:500,"&:hover":{textDecoration:"underline"}},children:g||"N/A"})}},{header:"Descripción",accessorKey:"description",cell:({getValue:n})=>{const o=n();return e.jsx(p,{variant:"body2",sx:{maxWidth:300},noWrap:!0,children:o||"N/A"})}},{header:"Estado",accessorKey:"status",cell:({getValue:n})=>{const o=n();return e.jsx(S,{label:o?"Activo":"Inactivo",color:o?"success":"error",size:"small",variant:"light"})}},{header:"Fecha Creación",accessorKey:"createdAt",cell:({getValue:n})=>{const o=n();return o?new Date(o).toLocaleDateString("es-ES"):"N/A"}},{header:"Acciones",id:"actions",cell:({row:n})=>{const o=()=>l==null?void 0:l(n.original),g=()=>i==null?void 0:i(n.original),m=()=>s==null?void 0:s(n.original),y=()=>u==null?void 0:u(n.original);return e.jsxs(E,{direction:"row",spacing:.5,alignItems:"center",children:[s&&e.jsx(B,{title:"Asignar Empleados",children:e.jsx(V,{size:"small",color:"info",onClick:m,children:e.jsx(te,{size:18})})}),u&&e.jsx(B,{title:"Asignar Usuarios",children:e.jsx(V,{size:"small",color:"secondary",onClick:y,children:e.jsx(W,{size:18})})}),l&&e.jsx(B,{title:"Editar",children:e.jsx(V,{size:"small",color:"primary",onClick:o,children:e.jsx(ue,{size:18})})}),i&&e.jsx(B,{title:"Eliminar",children:e.jsx(V,{size:"small",color:"error",onClick:g,children:e.jsx(H,{size:18})})})]})},enableSorting:!1,enableColumnFilter:!1,size:150}]}const Ge=({open:l,onClose:i,group:s,companyId:u})=>{const[n,o]=h.useState(!1),[g,m]=h.useState({}),[y,T]=h.useState({}),{dialogState:f,openDialog:L,closeDialog:b}=P(),{employeeCompanies:D,employeeCompaniesLoading:w}=xe(u),{employeeCompanyVisitGroups:k,employeeCompanyVisitGroupsLoading:I,refreshEmployeeCompanyVisitGroups:A}=ye(s==null?void 0:s.id),N=()=>{m({}),T({}),i()},c=D.filter(a=>!k.some(t=>t.employeeCompanyId===a.id)),x=async()=>{const a=Object.keys(g).filter(t=>g[t]);if(a.length===0){j({open:!0,message:"Seleccione al menos un empleado",variant:"alert",alert:{color:"warning"}});return}o(!0);try{await fe(a,s.id),j({open:!0,message:`${a.length} empleado(s) asignado(s) exitosamente`,variant:"alert",alert:{color:"success"}}),m({}),A&&A()}catch(t){j({open:!0,message:t.message||"Error al asignar empleados",variant:"alert",alert:{color:"error"}})}finally{o(!1)}},d=h.useMemo(()=>[{id:"select",header:({table:a})=>e.jsx(G,{checked:a.getIsAllPageRowsSelected(),indeterminate:a.getIsSomePageRowsSelected(),onChange:t=>{a.getToggleAllPageRowsSelectedHandler()(t)},sx:{padding:0}}),cell:({row:a})=>e.jsx(G,{checked:a.getIsSelected(),disabled:!a.getCanSelect(),onChange:t=>{a.getToggleSelectedHandler()(t)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Id",accessorKey:"id",cell:({getValue:a})=>e.jsx(S,{label:a()||"N/A",size:"small",color:"primary",variant:"light"}),size:100,defaultIsVisible:!1},{header:"Código",accessorKey:"codeEmployee",cell:({getValue:a})=>e.jsx(S,{label:a()||"N/A",size:"small",color:"primary",variant:"light"}),size:100},{header:"Identificación",accessorKey:"employeeIdentification",cell:({getValue:a})=>e.jsx(p,{variant:"body2",children:a()||"N/A"})},{header:"Nombres",accessorKey:"employeeFirstName",cell:({getValue:a})=>e.jsx(p,{variant:"body2",sx:{fontWeight:500},children:a()||"N/A"})},{header:"Apellidos",accessorKey:"employeeLastName",cell:({getValue:a})=>e.jsx(p,{variant:"body2",sx:{fontWeight:500},children:a()||"N/A"})},{header:"Estado",accessorKey:"status",cell:({getValue:a})=>e.jsx(S,{label:a()?"Activo":"Inactivo",color:a()?"success":"error",size:"small",variant:"light"}),size:100}],[]),v=h.useMemo(()=>[{id:"select",header:({table:a})=>e.jsx(G,{checked:a.getIsAllPageRowsSelected(),indeterminate:a.getIsSomePageRowsSelected(),onChange:t=>{a.getToggleAllPageRowsSelectedHandler()(t)},sx:{padding:0}}),cell:({row:a})=>e.jsx(G,{checked:a.getIsSelected(),disabled:!a.getCanSelect(),onChange:t=>{a.getToggleSelectedHandler()(t)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Código",accessorKey:"employeeCompany.codeEmployee",cell:({row:a})=>{var t;return e.jsx(S,{label:((t=a.original.employeeCompany)==null?void 0:t.codeEmployee)||"N/A",size:"small",color:"primary"})},size:100},{header:"Identificación",accessorKey:"employeeCompany.employeeIdentification",cell:({row:a})=>{var t,M,q;return e.jsx(p,{variant:"body2",children:((t=a.original.employeeCompany)==null?void 0:t.employeeIdentification)||((q=(M=a.original.employeeCompany)==null?void 0:M.employee)==null?void 0:q.identification)||"N/A"})}},{header:"Nombres",accessorKey:"employeeCompany.employeeFirstName",cell:({row:a})=>{var t;return e.jsx(p,{variant:"body2",sx:{fontWeight:500},children:((t=a.original.employeeCompany)==null?void 0:t.employeeFirstName)||"N/A"})}},{header:"Apellidos",accessorKey:"employeeCompany.employeeLastName",cell:({row:a})=>{var t;return e.jsx(p,{variant:"body2",sx:{fontWeight:500},children:((t=a.original.employeeCompany)==null?void 0:t.employeeLastName)||"N/A"})}},{header:"Teléfono",accessorKey:"employeeCompany.employee.cellphoneNumber",cell:({row:a})=>{var t,M;return e.jsx(p,{variant:"body2",children:((M=(t=a.original.employeeCompany)==null?void 0:t.employee)==null?void 0:M.cellphoneNumber)||"N/A"})}},{header:"Fecha Asignación",accessorKey:"createdAt",cell:({getValue:a})=>{const t=a();return t?new Date(t).toLocaleDateString("es-ES"):"N/A"},size:120}],[]),O=async()=>{const a=Object.keys(y).filter(t=>y[t]);if(a.length===0){j({open:!0,message:"Seleccione al menos un empleado",variant:"alert",alert:{color:"warning"}});return}L({title:"Desasignar Empleados",message:`¿Está seguro de desasignar ${a.length} empleado(s)?`,severity:"warning",confirmText:"Desasignar",onConfirm:async()=>{o(!0);try{await je(a,s.id),j({open:!0,message:`${a.length} empleado(s) desasignado(s) exitosamente`,variant:"alert",alert:{color:"success"}}),T({}),A&&A()}catch(t){j({open:!0,message:t.message||"Error al desasignar empleados",variant:"alert",alert:{color:"error"}})}finally{o(!1)}}})};return e.jsxs(X,{open:l,onClose:N,maxWidth:"lg",fullWidth:!0,children:[e.jsx(Y,{children:"Asignar Empleados al Grupo"}),e.jsx(_,{children:e.jsxs(E,{spacing:3,sx:{mt:1},children:[e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Grupo: ",e.jsx("strong",{children:s==null?void 0:s.name})," (",s==null?void 0:s.code,")"]}),e.jsx(R,{}),e.jsx(C,{children:w?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(U,{})}):c.length===0?e.jsx(p,{variant:"body2",color:"text.secondary",children:"No hay empleados disponibles para asignar"}):e.jsx(C,{sx:{maxHeight:400,overflow:"auto"},children:e.jsx(Z,{toolbarButtons:[{label:`Asignar Seleccionados (${Object.keys(g).filter(a=>g[a]).length})`,icon:e.jsx(K,{}),toolTip:`Asignar Seleccionados (${Object.keys(g).filter(a=>g[a]).length})`,variant:"contained",onClick:x,disabled:Object.keys(g).filter(a=>g[a]).length===0}],data:c,columns:d,enableRowSelection:!0,filterOnHeaderVisible:!0,tableId:"assignEmployeesTable",onRowSelectionChange:m,rowSelection:g,isDownload:!1})})}),e.jsx(R,{}),e.jsx(C,{children:I?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(U,{})}):k.length===0?e.jsx(p,{variant:"body2",color:"text.secondary",children:"No hay empleados asignados a este grupo"}):e.jsx(C,{sx:{maxHeight:400,overflow:"auto"},children:e.jsx(Z,{title:"Empleados Asignados",toolbarButtons:[{label:`Desasignar Seleccionados (${Object.keys(y).filter(a=>y[a]).length})`,icon:e.jsx(H,{}),toolTip:"Desasignar empleados seleccionados",variant:"contained",color:"error",onClick:O,disabled:Object.keys(y).filter(a=>y[a]).length===0}],data:k,columns:v,enableRowSelection:!0,filterOnHeaderVisible:!0,tableId:"assignedEmployeesTable",onRowSelectionChange:T,rowSelection:y,isDownload:!1})})})]})}),e.jsx(ee,{children:e.jsx(F,{onClick:N,disabled:n,children:"Cerrar"})}),e.jsx($,{open:f.open,title:f.title,message:f.message,onConfirm:f.onConfirm,onCancel:b,confirmText:f.confirmText,cancelText:f.cancelText,severity:f.severity})]})},Me=Ge,ze=({open:l,onClose:i,group:s})=>{const[u,n]=h.useState(!1),[o,g]=h.useState(""),{dialogState:m,openDialog:y,closeDialog:T}=P(),{users:f,usersLoading:L}=ke(),{userCompanyVisitGroups:b,userCompanyVisitGroupsLoading:D,refreshUserCompanyVisitGroups:w}=ve(s==null?void 0:s.id),k=()=>{g(""),i()},I=h.useMemo(()=>f.filter(c=>!b.some(x=>x.userId===c.id)),[f,b]),A=async()=>{if(!o){j({open:!0,message:"Seleccione un usuario",variant:"alert",alert:{color:"warning"}});return}n(!0);try{await Ce(o,s.id),j({open:!0,message:"Usuario asignado exitosamente",variant:"alert",alert:{color:"success"}}),g(""),w&&w()}catch(c){j({open:!0,message:c.message||"Error al asignar usuario",variant:"alert",alert:{color:"error"}})}finally{n(!1)}},N=async c=>{const x=c.user,d=(x==null?void 0:x.fullName)||(x==null?void 0:x.userName)||"este usuario";y({title:"Desasignar Usuario",message:`¿Está seguro de desasignar al usuario "${d}"?`,severity:"warning",confirmText:"Desasignar",onConfirm:async()=>{n(!0);try{await be(c.id,s.id),j({open:!0,message:"Usuario desasignado exitosamente",variant:"alert",alert:{color:"success"}}),w&&w()}catch(v){j({open:!0,message:v.message||"Error al desasignar usuario",variant:"alert",alert:{color:"error"}})}finally{n(!1)}}})};return e.jsxs(X,{open:l,onClose:k,maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{children:"Asignar Usuarios al Grupo"}),e.jsx(_,{children:e.jsxs(E,{spacing:3,sx:{mt:1},children:[e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Grupo: ",e.jsx("strong",{children:s==null?void 0:s.name})," (",s==null?void 0:s.code,")"]}),e.jsx(R,{}),e.jsxs(C,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Asignar Usuario"}),L?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(U,{})}):e.jsxs(E,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsxs(re,{fullWidth:!0,children:[e.jsx(Ae,{id:"select-user-label",children:"Usuario"}),e.jsx(ne,{labelId:"select-user-label",id:"select-user",value:o,label:"Usuario",onChange:c=>g(c.target.value),disabled:u||I.length===0,children:I.length===0?e.jsx(J,{value:"",children:e.jsx("em",{children:"No hay usuarios disponibles"})}):I.map(c=>e.jsx(J,{value:c.id,children:e.jsxs(E,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(p,{children:c.fullName||c.userName}),e.jsx(S,{label:c.email,size:"small",variant:"outlined"}),e.jsx(S,{label:c.role,size:"small",color:c.role==="Admin"?"primary":"default",variant:"light"})]})},c.id))})]}),e.jsx(F,{variant:"contained",startIcon:e.jsx(K,{}),onClick:A,disabled:u||!o,sx:{minWidth:120},children:"Asignar"})]})]}),e.jsx(R,{}),e.jsxs(C,{children:[e.jsxs(p,{variant:"h6",gutterBottom:!0,children:["Usuarios Asignados (",b.length,")"]}),D?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(U,{})}):b.length===0?e.jsx(p,{variant:"body2",color:"text.secondary",children:"No hay usuarios asignados a este grupo"}):e.jsx(oe,{children:b.map((c,x)=>{const d=c.user;return e.jsxs(r.Fragment,{children:[e.jsxs(le,{sx:{border:1,borderColor:"divider",borderRadius:1,mb:1,bgcolor:"background.paper"},children:[e.jsx(ie,{primary:e.jsxs(E,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(p,{variant:"subtitle2",children:(d==null?void 0:d.fullName)||(d==null?void 0:d.userName)}),e.jsx(S,{label:d==null?void 0:d.email,size:"small",variant:"outlined"}),e.jsx(S,{label:d==null?void 0:d.role,size:"small",color:(d==null?void 0:d.role)==="Admin"?"primary":"default",variant:"light"})]}),secondary:e.jsxs(E,{spacing:.5,sx:{mt:.5},children:[e.jsxs(p,{variant:"caption",color:"text.secondary",children:["Estado: ",d!=null&&d.isActive?"Activo":"Inactivo"]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["Asignado el: ",new Date(c.createdAt).toLocaleDateString("es-ES")]})]})}),e.jsx(ce,{children:e.jsx(V,{edge:"end",color:"error",onClick:()=>N(c),disabled:u,children:e.jsx(H,{size:20})})})]}),x<b.length-1&&e.jsx(R,{})]},c.id)})})]})]})}),e.jsx(ee,{children:e.jsx(F,{onClick:k,disabled:u,children:"Cerrar"})}),e.jsx($,{open:m.open,title:m.title,message:m.message,onConfirm:m.onConfirm,onCancel:T,confirmText:m.confirmText,cancelText:m.cancelText,severity:m.severity})]})},Ve=ze;function Qe(){const l=de(),{selectedCompany:i}=me(),s=i==null?void 0:i.companyId,{companyVisitGroups:u,companyVisitGroupsLoading:n,companyVisitGroupsError:o,refreshCompanyVisitGroups:g}=ge(s),{dialogState:m,openDialog:y,closeDialog:T}=P(),[f,L]=h.useState(null),[b,D]=h.useState(!1),[w,k]=h.useState(!1);h.useEffect(()=>{g&&g()},[g]);const I=h.useCallback(()=>{l("/apps/visits/groups/create")},[l]),A=h.useCallback(v=>{l(`/apps/visits/groups/edit/${v.id}`)},[l]),N=h.useCallback(async v=>{y({title:"Eliminar Grupo",message:`¿Está seguro de eliminar el grupo "${v.name}"? Esta acción no se puede deshacer.`,severity:"error",confirmText:"Eliminar",onConfirm:async()=>{try{await he(v.id,s),j({open:!0,message:"Grupo eliminado exitosamente",variant:"alert",alert:{color:"success"}})}catch(O){j({open:!0,message:O.message||"Error al eliminar el grupo",variant:"alert",alert:{color:"error"}})}}})},[s,y]),c=h.useCallback(v=>{L(v),D(!0)},[]),x=h.useCallback(v=>{L(v),k(!0)},[]),d=h.useMemo(()=>De({onEdit:A,onDelete:N,onAssignEmployees:c,onAssignUsers:x}),[A,N,c,x]);return n?e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(U,{})}):o?e.jsx(C,{sx:{p:3},children:e.jsx(p,{color:"error",children:"Error al cargar los grupos de visitas"})}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{content:!1,children:e.jsxs(E,{spacing:3,sx:{p:3},children:[e.jsxs(E,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(p,{variant:"h5",children:"Grupos de Visitas"}),e.jsx(F,{variant:"contained",size:"small",startIcon:e.jsx(K,{}),onClick:I,sx:{fontWeight:600},children:"Nuevo Grupo"})]}),e.jsx(Z,{data:u||[],columns:d,filterOnHeaderVisible:!0,enableRowSelection:!0,tableId:"companyVisitGroupsTable",tableNowrap:!0})]})}),e.jsx(Me,{open:b,group:f,companyId:s,onClose:()=>D(!1)}),e.jsx(Ve,{open:w,group:f,onClose:()=>k(!1)}),e.jsx($,{open:m.open,title:m.title,message:m.message,severity:m.severity,confirmText:m.confirmText,cancelText:m.cancelText,onConfirm:m.onConfirm,onCancel:T})]})}export{Qe as default};
