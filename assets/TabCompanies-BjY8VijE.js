import{av as w,w as L,r as j,j as e,M as D,F as f,G as c,k as o,S as y,H as k,J as B,K as z,O as U,X as G,B as M,Z as F,$ as N,a0 as R,C as W,a1 as O,Q as $,A as d}from"./index-pwr-e4Ht.js";import{u as H,T as J,C as K}from"./useConfirmDialog-B93jbB1J.js";import{u as P,a as Q,b as X}from"./usersCompanies-D77p7jC4.js";import{u as Z}from"./companies-DDk-XUBx.js";import{A as q}from"./ArrowLeft-D0sQWMEh.js";import{I as V}from"./InputLabel-BRdiyk76.js";import{C}from"./CircularProgress-JbuhKxWk.js";function ne(){const{user:t}=w(),v=L(),[l,x]=j.useState(""),[m,p]=j.useState(!1),{dialogState:n,openDialog:b,closeDialog:I}=H(),{userCompanies:a,userCompaniesLoading:A,mutateUserCompanies:u}=P(t==null?void 0:t.id),{companies:i,companiesLoading:h}=Z(),g=(i==null?void 0:i.filter(s=>!(a!=null&&a.some(r=>r.companyId===s.id))))||[],E=async()=>{if(!(!l||!t)){p(!0);try{await Q(t.id,l),await u(),x(""),d({open:!0,message:"Empresa asignada exitosamente",variant:"alert",alert:{color:"success"}})}catch{d({open:!0,message:"Error al asignar la empresa",variant:"alert",alert:{color:"error"}})}finally{p(!1)}}},S=async s=>{t&&b({title:"Desasignar Empresa",message:"¿Está seguro de desasignar esta empresa del usuario?",severity:"warning",confirmText:"Desasignar",onConfirm:async()=>{try{await X(s,t.id),await u(),d({open:!0,message:"Empresa desasignada exitosamente",variant:"alert",alert:{color:"success"}})}catch{d({open:!0,message:"Error al desasignar la empresa",variant:"alert",alert:{color:"error"}})}}})};return e.jsxs(D,{content:!1,title:"Empresas Asignadas",secondary:e.jsx(f,{variant:"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>v("/apps/users/list"),sx:{fontWeight:600},children:"Regresar"}),sx:{"& .MuiInputLabel-root":{fontSize:"0.875rem"}},children:[e.jsxs(c,{container:!0,spacing:3,sx:{p:3},children:[e.jsxs(c,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Asignar Nueva Empresa"}),e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",sx:{mt:2},children:[e.jsxs(k,{fullWidth:!0,sx:{maxWidth:400},children:[e.jsx(V,{children:"Seleccione Empresa"}),e.jsx(B,{value:l,onChange:s=>x(s.target.value),label:"Seleccione Empresa",disabled:h||m||!g.length,children:g.map(s=>e.jsxs(z,{value:s.id,children:[s.code," - ",s.name]},s.id))})]}),e.jsx(f,{variant:"contained",startIcon:m?e.jsx(C,{size:16}):e.jsx(U,{}),onClick:E,disabled:!l||m,children:"Asignar"})]}),!g.length&&!h&&e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Todas las empresas disponibles ya están asignadas"})]}),e.jsx(c,{item:!0,xs:12,children:e.jsx(G,{})}),e.jsxs(c,{item:!0,xs:12,children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,children:["Empresas Asignadas (",(a==null?void 0:a.length)||0,")"]}),A?e.jsx(M,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(C,{})}):a&&a.length>0?e.jsx(F,{children:a.map(s=>{const r=i==null?void 0:i.find(T=>T.id===s.companyId);return e.jsxs(N,{sx:{border:1,borderColor:"divider",borderRadius:1,mb:1,bgcolor:"background.paper"},children:[e.jsx(R,{primary:e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(W,{label:(r==null?void 0:r.code)||s.companyId,size:"small",color:"primary"}),e.jsx(o,{variant:"subtitle2",children:(r==null?void 0:r.name)||"Empresa"})]}),secondary:s.assignedAt?`Asignada el: ${new Date(s.assignedAt).toLocaleDateString("es-ES")}`:null}),e.jsx(O,{children:e.jsx($,{edge:"end",color:"error",onClick:()=>S(s.id),children:e.jsx(J,{size:18})})})]},s.id)})}):e.jsx(o,{variant:"body2",color:"text.secondary",sx:{py:2,textAlign:"center"},children:"No hay empresas asignadas a este usuario"})]})]}),e.jsx(K,{open:n.open,title:n.title,message:n.message,onConfirm:n.onConfirm,onCancel:I,confirmText:n.confirmText,cancelText:n.cancelText,severity:n.severity})]})}export{ne as default};
