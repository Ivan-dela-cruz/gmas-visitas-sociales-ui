import{w as z,r as y,y as E,j as e,G as o,D as R,E as W,F as u,k as g,H as B,J as G,K as v,S as N,P as d}from"./index-CMlrmw9_.js";import{u as q,C as m}from"./index.esm-Ds7NXHRL.js";import{b as H,i as $}from"./visits-CuehpNSv.js";import{u as J}from"./useTabStyles-DqcpglRn.js";import{u as K,a as M}from"./useFormLifecycle-C2gz9Zyk.js";import{T as C}from"./TextField-B_-UPyso.js";import{I as O}from"./InputLabel-BcyW2Dv4.js";import{C as Q}from"./CircularProgress-C4wVOatm.js";const S=({visit:t=null,isEdit:a=!1,refreshVisits:x=null})=>{const h=z(),{tabPanelStyles:V}=J(),[i,p]=y.useState(!1),{selectedCompany:n}=E(),{control:l,handleSubmit:w,reset:c,watch:F,formState:{errors:f}}=q({defaultValues:{title:"",observation:"",status:!0}}),T=F(),{handleError:I,handleSuccess:j,handleWarning:L}=K("visit-form",{onSuccess:()=>{x&&x(),h("/apps/visits/list")}}),{showRecoveryAlert:A,clearRecoveredData:b,onSuccessSubmit:D}=M(`visit-form-${a?t==null?void 0:t.id:"create"}`,T,c,a);y.useEffect(()=>{t&&a&&c({title:t.title||"",observation:t.observation||"",status:t.status??!0})},[t,a,c]);const P=async s=>{if(!n){L("Debe seleccionar una empresa");return}p(!0);try{const r={...s,idCompany:n.companyId};a&&t?(await H({...r,id:t.id}),j("Visita actualizada exitosamente")):(await $(r),j("Visita creada exitosamente")),D()}catch(r){I(r,s,a?"update":"create")}finally{p(!1)}},k=()=>{h("/apps/visits/list")};return e.jsx("form",{onSubmit:w(P),style:{...V,paddingLeft:"2rem",paddingRight:"2rem",paddingBottom:"2rem"},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(R,{in:A,children:e.jsxs(W,{severity:"info",onClose:()=>b(),sx:{mb:2},children:["Se detectaron datos guardados de un intento anterior. Los datos han sido restaurados. Puedes continuar editando o",e.jsx(u,{size:"small",sx:{ml:1},onClick:b,children:"Limpiar"})]})})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(g,{variant:"h5",gutterBottom:!0,children:["Información de la ",a?"Visita":"Nueva Visita"]})}),n&&e.jsx(o,{item:!0,xs:12,children:e.jsxs(g,{variant:"body2",color:"text.secondary",children:["Empresa: ",e.jsx("strong",{children:n.companyName})," (",n.companyCode,")"]})}),e.jsx(o,{item:!0,xs:12,sm:8,children:e.jsx(m,{name:"title",control:l,rules:{required:"El título es requerido"},render:({field:s})=>{var r;return e.jsx(C,{...s,fullWidth:!0,label:"Título *",error:!!f.title,helperText:(r=f.title)==null?void 0:r.message})}})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(m,{name:"status",control:l,render:({field:s})=>e.jsxs(B,{fullWidth:!0,children:[e.jsx(O,{children:"Estado"}),e.jsxs(G,{...s,label:"Estado",value:s.value?"true":"false",onChange:r=>s.onChange(r.target.value==="true"),children:[e.jsx(v,{value:"true",children:"Activo"}),e.jsx(v,{value:"false",children:"Inactivo"})]})]})})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(m,{name:"observation",control:l,render:({field:s})=>e.jsx(C,{...s,fullWidth:!0,label:"Observación",multiline:!0,rows:4,placeholder:"Ingrese observaciones sobre la visita"})})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(N,{direction:"row",spacing:2,justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(u,{variant:"outlined",color:"secondary",onClick:k,disabled:i,children:"Cancelar"}),e.jsx(u,{variant:"contained",type:"submit",disabled:i||!n,children:i?e.jsx(Q,{size:24}):a?"Actualizar":"Guardar"})]})})]})})};S.propTypes={visit:d.object,isEdit:d.bool,refreshVisits:d.func};const re=S;export{re as V};
