import{j as a,k as g,v as o,C as m,S as F,I as u,w as k,y as A,r as n,A as b,O as D,M as C}from"./index-1Ft_9Ggc.js";import{B as E}from"./index-BjSYZTsY.js";import{u as I,d as V}from"./visits-BuCwd_D6.js";import{T as z,u as T,C as K}from"./useConfirmDialog-CQLSOUm7.js";import{C as v}from"./Checkbox-DqjWukHG.js";import{D as w}from"./DocumentText-D9_NxQCj.js";import{E as N}from"./Eye-f_-KHjj9.js";import{E as P}from"./Edit-DQ11tA_q.js";import"./ArrowLeft-DKPi0vkA.js";import"./TextField-BUrLKZCC.js";import"./InputLabel-CmXrBjAs.js";import"./FormHelperText-RF1wYTFR.js";const B=({onEdit:s,onDelete:i,onView:c,onViewDetails:d}={})=>[{id:"select",header:({table:e})=>a.jsx(v,{checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:t=>{e.getToggleAllPageRowsSelectedHandler()(t)},sx:{padding:0}}),cell:({row:e})=>a.jsx(v,{checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:t=>{e.getToggleSelectedHandler()(t)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{accessorKey:"id",header:"ID",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:320,filterFn:"includesString",defaultIsVisible:!1,toolTip:"ID de la visita"},{accessorKey:"title",header:"Título",cell:({getValue:e})=>{const t=e();return a.jsx(g,{variant:"subtitle2",align:"left",children:t||"Sin título"})},enableColumnFilter:!0,size:250,filterFn:"includesString"},{accessorKey:"observation",header:"Observación",cell:({getValue:e})=>{const t=e();return a.jsx(o,{title:t||"Sin observación",children:a.jsx(g,{variant:"body2",align:"left",noWrap:!0,sx:{maxWidth:300},children:t||"Sin observación"})})},enableColumnFilter:!0,size:300,filterFn:"includesString"},{accessorKey:"createdAt",header:"Fecha de Creación",cell:({getValue:e})=>{const t=e();return t?new Date(t).toLocaleDateString("es-ES"):"N/A"},enableColumnFilter:!1,size:150,defaultIsVisible:!1},{accessorKey:"updatedAt",header:"Última Actualización",cell:({getValue:e})=>{const t=e();return t?new Date(t).toLocaleDateString("es-ES"):"N/A"},enableColumnFilter:!1,size:150},{accessorKey:"userUpdatedBy",header:"Actualizado por",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:120,filterFn:"includesString",defaultIsVisible:!1,meta:{align:"left"}},{accessorKey:"userCreatedBy",header:"Creado por",cell:({getValue:e})=>e()||"N/A",enableColumnFilter:!0,size:120,filterFn:"includesString",defaultIsVisible:!1},{accessorKey:"status",header:"Estado",cell:e=>{const t=e.getValue();return t===!0||t==="active"||t===1?a.jsx(m,{color:"success",label:"Activo",size:"small",variant:"light"}):t===!1||t==="inactive"||t===0?a.jsx(m,{color:"error",label:"Inactivo",size:"small",variant:"light"}):a.jsx(m,{color:"info",label:"Desconocido",size:"small",variant:"light"})},meta:{align:"center"},enableColumnFilter:!1,size:100},{id:"actions",header:"Acciones",accessorKey:"actions",cell:({row:e})=>{const t=e.original;return a.jsxs(F,{direction:"row",alignItems:"center",justifyContent:"center",spacing:0,children:[d&&a.jsx(o,{title:"Ver Detalles",children:a.jsx(u,{color:"info",onClick:l=>{l.stopPropagation(),d(t)},children:a.jsx(w,{})})}),c&&a.jsx(o,{title:"Ver",children:a.jsx(u,{color:"secondary",onClick:l=>{l.stopPropagation(),c(t)},children:a.jsx(N,{})})}),s&&a.jsx(o,{title:"Editar",children:a.jsx(u,{color:"primary",onClick:l=>{l.stopPropagation(),s(t)},children:a.jsx(P,{})})}),i&&a.jsx(o,{title:"Eliminar",children:a.jsx(u,{color:"error",onClick:l=>{l.stopPropagation(),i(t)},children:a.jsx(z,{})})})]})},enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:120,meta:{skipFilter:!0,align:"center"}}];function X(){const s=k(),{selectedCompany:i}=A(),{visitsLoading:c,visits:d}=I(i==null?void 0:i.companyId),{dialogState:e,openDialog:t,closeDialog:l}=T(),f=n.useCallback(()=>{s("/apps/visits/create")},[s]),p=n.useCallback(r=>{s(`/apps/visits/edit/${r.id}`)},[s]),h=n.useCallback(async r=>{t({title:"Eliminar Visita",message:`¿Está seguro de eliminar la visita "${r.title}"?`,severity:"error",confirmText:"Eliminar",onConfirm:async()=>{try{await V(r.id,i==null?void 0:i.companyId),b({open:!0,message:"Visita eliminada exitosamente",variant:"alert",alert:{color:"success"}})}catch(y){b({open:!0,message:y.message||"Error al eliminar la visita",variant:"alert",alert:{color:"error"}})}}})},[i,t]),x=n.useCallback(r=>{s(`/apps/visits/${r.id}/profile/details`)},[s]),j=n.useMemo(()=>[{label:"Nueva Visita",icon:a.jsx(D,{}),onClick:f,color:"primary",variant:"contained"}],[f]),S=n.useMemo(()=>B({onEdit:p,onDelete:h,onViewDetails:x}),[p,h,x]);return c?a.jsx(C,{children:a.jsx(g,{variant:"h5",align:"center",children:"Cargando visitas..."})}):a.jsxs(C,{content:!1,children:[a.jsx(E,{tableId:"visits-table",title:"Lista de Visitas",columns:S,data:d,enableRowSelection:!0,filterOnHeaderVisible:!0,tableNowrap:!0,actions:j}),a.jsx(K,{open:e.open,title:e.title,message:e.message,onConfirm:e.onConfirm,onCancel:l,confirmText:e.confirmText,cancelText:e.cancelText,severity:e.severity})]})}export{X as default};
