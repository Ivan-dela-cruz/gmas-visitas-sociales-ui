import{w as k,y as B,r as L,j as e,M as N,B as W,k as u,G as s,D as H,E as O,F as E,H as g,J as b,K as o,S as z,N as M}from"./index-3l9d1KGW.js";import{u as R,C as d}from"./index.esm-C1Hzu-K8.js";import{a as J,i as K,b as V,u as Q}from"./employees-Cvz28YT6.js";import{u as U}from"./catalogs-CNbRlm82.js";import{u as X,a as Y}from"./useFormLifecycle-BcTx0tZR.js";import{C as y}from"./CircularProgress-J6yogQxx.js";import{T as c}from"./TextField-ipHljcwd.js";import{I as f}from"./InputLabel-CWODz4nt.js";import{F as Z}from"./FormHelperText-BXYwuqgf.js";import"./useFormErrorRecovery-nUWcN-GT.js";const _=({employee:t=null,isEdit:n=!1,refreshEmployees:m=null})=>{const p=k(),{selectedCompany:x}=B(),[h,S]=L.useState(!1),{catalogs:v,isLoading:j}=U(),{control:l,handleSubmit:P,reset:C,watch:I,formState:{errors:a}}=R({defaultValues:{identification:"",firstName:"",middleName:"",lastName:"",secondLastName:"",dateBirth:"",idSex:"",idTypeDisability:"",degreeDisability:"",idCivilState:"",idEducationLevel:"",cellphoneNumber:"",degreeObtained:"",emergencyContact:"",emergencyContactPhone:"",status:!0}}),q=I(),{handleError:F,handleSuccess:T}=X("employee-form",{onSuccess:()=>{m&&m(),p("/apps/employees/list")}}),{showRecoveryAlert:A,clearRecoveredData:D,onSuccessSubmit:w}=Y(`employee-form-${n?t==null?void 0:t.id:"create"}`,q,C,n);L.useEffect(()=>{t&&n&&C({identification:t.identification||"",firstName:t.firstName||"",middleName:t.middleName||"",lastName:t.lastName||"",secondLastName:t.secondLastName||"",dateBirth:t.dateBirth?t.dateBirth.split("T")[0]:"",idSex:t.idSex||"",idTypeDisability:t.idTypeDisability||"",degreeDisability:t.degreeDisability||"",idCivilState:t.idCivilState||"",idEducationLevel:t.idEducationLevel||"",cellphoneNumber:t.cellphoneNumber||"",degreeObtained:t.degreeObtained||"",emergencyContact:t.emergencyContact||"",emergencyContactPhone:t.emergencyContactPhone||"",status:t.status??!0})},[t,n,C]);const G=async r=>{S(!0);try{const i={...r,id:t==null?void 0:t.id,idCompany:(t==null?void 0:t.idCompany)??(x==null?void 0:x.companyId)??null,idSex:r.idSex?Number(r.idSex):null,idTypeDisability:r.idTypeDisability?Number(r.idTypeDisability):null,degreeDisability:r.degreeDisability?Number(r.degreeDisability):null,idCivilState:r.idCivilState?Number(r.idCivilState):null,idEducationLevel:r.idEducationLevel?Number(r.idEducationLevel):null,dateBirth:r.dateBirth?`${r.dateBirth}T00:00:00`:null};n&&t?(await J(i),T("Empleado actualizado exitosamente")):(await K(i),T("Empleado creado exitosamente")),w()}catch(i){F(i,r,n?"update":"create")}finally{S(!1)}},$=()=>{p("/apps/employees/list")};return j?e.jsx(N,{title:n?"Editar Empleado":"Nuevo Empleado",children:e.jsxs(W,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[e.jsx(y,{}),e.jsx(u,{variant:"body1",sx:{ml:2},children:"Cargando catálogos..."})]})}):e.jsx(N,{title:n?"Editar Empleado":"Nuevo Empleado",children:e.jsx("form",{onSubmit:P(G),children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(H,{in:A,children:e.jsxs(O,{severity:"info",onClose:()=>D(),sx:{mb:2},children:["Se detectaron datos guardados de un intento anterior. Los datos han sido restaurados. Puedes continuar editando o",e.jsx(E,{size:"small",sx:{ml:1},onClick:D,children:"Limpiar"})]})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{variant:"h5",gutterBottom:!0,children:"Información Personal"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"identification",control:l,rules:{required:"La cédula es requerida",pattern:{value:/^[0-9]{10}$/,message:"La cédula debe tener 10 dígitos"}},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Cédula *",error:!!a.identification,helperText:(i=a.identification)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"firstName",control:l,rules:{required:"El primer nombre es requerido"},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Primer Nombre *",error:!!a.firstName,helperText:(i=a.firstName)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"middleName",control:l,render:({field:r})=>e.jsx(c,{...r,fullWidth:!0,label:"Segundo Nombre"})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"lastName",control:l,rules:{required:"El apellido paterno es requerido"},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Apellido Paterno *",error:!!a.lastName,helperText:(i=a.lastName)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"secondLastName",control:l,render:({field:r})=>e.jsx(c,{...r,fullWidth:!0,label:"Apellido Materno"})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"dateBirth",control:l,rules:{required:"La fecha de nacimiento es requerida"},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Fecha de Nacimiento *",type:"date",InputLabelProps:{shrink:!0},error:!!a.dateBirth,helperText:(i=a.dateBirth)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"idSex",control:l,rules:{required:"El sexo es requerido"},render:({field:r})=>e.jsxs(g,{fullWidth:!0,error:!!a.idSex,disabled:j,children:[e.jsx(f,{children:"Sexo *"}),e.jsxs(b,{...r,label:"Sexo *",children:[e.jsx(o,{value:"",children:"Seleccionar"}),v.sex.map(i=>e.jsx(o,{value:i.id,children:i.description},i.id))]}),a.idSex&&e.jsx(Z,{children:a.idSex.message})]})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(d,{name:"idCivilState",control:l,render:({field:r})=>e.jsxs(g,{fullWidth:!0,disabled:j,children:[e.jsx(f,{children:"Estado Civil"}),e.jsxs(b,{...r,label:"Estado Civil",children:[e.jsx(o,{value:"",children:"Ninguno"}),v.maritalStatus.map(i=>e.jsx(o,{value:i.id,children:i.description},i.id))]})]})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:2},children:"Información de Contacto"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"cellphoneNumber",control:l,rules:{required:"El celular es requerido",pattern:{value:/^[0-9]{10}$/,message:"El celular debe tener 10 dígitos"}},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Celular *",error:!!a.cellphoneNumber,helperText:(i=a.cellphoneNumber)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"emergencyContact",control:l,render:({field:r})=>e.jsx(c,{...r,fullWidth:!0,label:"Contacto de Emergencia"})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"emergencyContactPhone",control:l,rules:{pattern:{value:/^[0-9]{10}$/,message:"El teléfono debe tener 10 dígitos"}},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Teléfono de Emergencia",error:!!a.emergencyContactPhone,helperText:(i=a.emergencyContactPhone)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:2},children:"Información Académica"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"idEducationLevel",control:l,render:({field:r})=>e.jsxs(g,{fullWidth:!0,disabled:j,children:[e.jsx(f,{children:"Nivel de Educación"}),e.jsxs(b,{...r,label:"Nivel de Educación",children:[e.jsx(o,{value:"",children:"Ninguno"}),v.academicLevel.map(i=>e.jsx(o,{value:i.id,children:i.description},i.id))]})]})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"degreeObtained",control:l,render:({field:r})=>e.jsx(c,{...r,fullWidth:!0,label:"Título Obtenido"})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{variant:"h5",gutterBottom:!0,sx:{mt:2},children:"Información de Discapacidad"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"idTypeDisability",control:l,render:({field:r})=>e.jsxs(g,{fullWidth:!0,disabled:j,children:[e.jsx(f,{children:"Tipo de Discapacidad"}),e.jsxs(b,{...r,label:"Tipo de Discapacidad",children:[e.jsx(o,{value:"",children:"Ninguna"}),v.disabilityType.map(i=>e.jsx(o,{value:i.id,children:i.description},i.id))]})]})})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"degreeDisability",control:l,rules:{min:{value:0,message:"El grado debe ser mayor o igual a 0"},max:{value:100,message:"El grado debe ser menor o igual a 100"}},render:({field:r})=>{var i;return e.jsx(c,{...r,fullWidth:!0,label:"Grado de Discapacidad (%)",type:"number",inputProps:{min:0,max:100,step:.01},error:!!a.degreeDisability,helperText:(i=a.degreeDisability)==null?void 0:i.message})}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:4,children:e.jsx(d,{name:"status",control:l,render:({field:r})=>e.jsxs(g,{fullWidth:!0,children:[e.jsx(f,{children:"Estado"}),e.jsxs(b,{...r,label:"Estado",value:r.value?"true":"false",onChange:i=>r.onChange(i.target.value==="true"),children:[e.jsx(o,{value:"true",children:"Activo"}),e.jsx(o,{value:"false",children:"Inactivo"})]})]})})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(z,{direction:"row",spacing:2,justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(E,{variant:"outlined",color:"secondary",onClick:$,disabled:h,children:"Cancelar"}),e.jsx(E,{variant:"contained",type:"submit",disabled:h,children:h?e.jsx(y,{size:24}):n?"Actualizar":"Guardar"})]})})]})})})},ee=_;function ue(){const{id:t}=M(),{selectedCompany:n}=B(),{employee:m,employeeLoading:p,employeeError:x}=V(t),{refreshEmployees:h}=Q(n==null?void 0:n.companyId);return p?e.jsx(N,{children:e.jsx(W,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(y,{})})}):x||!m?e.jsx(N,{children:e.jsx(u,{variant:"h5",align:"center",color:"error",children:"Error al cargar el empleado"})}):e.jsx(ee,{employee:m,isEdit:!0,refreshEmployees:h})}export{ue as default};
