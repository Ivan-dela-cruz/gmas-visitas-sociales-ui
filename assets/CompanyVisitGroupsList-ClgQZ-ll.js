import{r as u,q as H,R as s,t as K,P as b,j as e,k as h,C as E,S as g,v as I,Q as A,m as $,U as q,V as J,W as Q,X as z,B as C,H as X,J as Y,K as Z,F as D,O as W,Y as _,Z as ee,$ as re,a0 as se,a1 as ae,A as j,w as te,y as ne,M as ie}from"./index-8i2qIeC5.js";import{u as oe,d as le}from"./companyVisitGroups-C4kYmZfl.js";import{C as V}from"./Checkbox-CUgLVUIU.js";import{E as ce}from"./Edit-C1XPeCcf.js";import{T as F,u as O,C as P}from"./useConfirmDialog-BqEGclvE.js";import{u as de}from"./users-YDXVqnkj.js";import{u as me,a as ue,b as he}from"./userCompanyVisitGroups-CougtyJK.js";import{C as B}from"./CircularProgress-Ba8lmjXM.js";import{I as pe}from"./InputLabel-BPE1mrZ-.js";import{B as xe}from"./index-iPnnsK5M.js";import"./ArrowLeft-D7tqb4HZ.js";import"./TextField-hsc-s2X2.js";import"./FormHelperText-DxDomcnh.js";var ge=["variant","color","size"],je=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{d:"M12 15c-5.01 0-9.09 3.36-9.09 7.5 0 .28.22.5.5.5h17.18c.28 0 .5-.22.5-.5 0-4.14-4.08-7.5-9.09-7.5ZM15.71 3.66A4.948 4.948 0 0 0 12 2c-1.4 0-2.68.57-3.59 1.51C7.54 4.41 7 5.65 7 7c0 .94.26 1.82.73 2.57.25.43.57.82.95 1.14.87.8 2.03 1.29 3.32 1.29 1.83 0 3.41-.98 4.28-2.43.26-.43.46-.91.57-1.41.1-.37.15-.76.15-1.16 0-1.28-.49-2.45-1.29-3.34Zm-1.84 4.26h-.93v.97a.939.939 0 1 1-1.88 0v-.97h-.93a.939.939 0 1 1 0-1.88h.93v-.89a.939.939 0 1 1 1.88 0v.89h.93a.939.939 0 1 1 0 1.88Z",fill:r}))},fe=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{d:"M15.02 3.01A4.944 4.944 0 0 0 12 2C9.24 2 7 4.24 7 7s2.24 5 5 5 5-2.24 5-5M3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:r,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.492 17.98h-2.98M18 16.52v2.99",stroke:r,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},ve=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{opacity:".4",d:"M21.09 21.5c0 .28-.22.5-.5.5H3.41c-.28 0-.5-.22-.5-.5 0-4.14 4.08-7.5 9.09-7.5 1.03 0 2.03.14 2.95.41-.59.7-.95 1.61-.95 2.59 0 .75.21 1.46.58 2.06.2.34.46.65.76.91.7.64 1.63 1.03 2.66 1.03 1.12 0 2.13-.46 2.85-1.2.16.54.24 1.11.24 1.7Z",fill:r}),s.createElement("path",{d:"M20.97 14.33A3.944 3.944 0 0 0 18 13a3.995 3.995 0 0 0-4 4c0 .75.21 1.46.58 2.06.2.34.46.65.76.91.7.64 1.63 1.03 2.66 1.03 1.46 0 2.73-.78 3.42-1.94.21-.34.37-.73.46-1.13.08-.3.12-.61.12-.93 0-1.02-.39-1.96-1.03-2.67Zm-1.47 3.4h-.75v.78c0 .41-.34.75-.75.75s-.75-.34-.75-.75v-.78h-.75c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h.75v-.71c0-.41.34-.75.75-.75s.75.34.75.75v.71h.75c.41 0 .75.34.75.75s-.34.75-.75.75ZM12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",fill:r}))},N=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{d:"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10ZM3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:r,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.49 17.98h-2.98M18 16.52v2.99",stroke:r,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},ye=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{d:"M12 12.75c-3.17 0-5.75-2.58-5.75-5.75S8.83 1.25 12 1.25 17.75 3.83 17.75 7s-2.58 5.75-5.75 5.75Zm0-10A4.26 4.26 0 0 0 7.75 7 4.26 4.26 0 0 0 12 11.25 4.26 4.26 0 0 0 16.25 7 4.26 4.26 0 0 0 12 2.75ZM3.41 22.75c-.41 0-.75-.34-.75-.75 0-4.27 4.19-7.75 9.34-7.75 1.01 0 2 .13 2.96.4.4.11.63.52.52.92-.11.4-.52.63-.92.52-.82-.23-1.68-.34-2.56-.34-4.32 0-7.84 2.8-7.84 6.25 0 .41-.34.75-.75.75Z",fill:r}),s.createElement("path",{d:"M18 22.75a4.7 4.7 0 0 1-3.17-1.23c-.35-.3-.66-.67-.9-1.08-.44-.72-.68-1.57-.68-2.44 0-1.25.48-2.42 1.34-3.31.9-.93 2.11-1.44 3.41-1.44 1.36 0 2.65.58 3.53 1.58A4.74 4.74 0 0 1 22.75 18c0 .38-.05.76-.15 1.12-.1.45-.29.92-.55 1.33-.83 1.42-2.39 2.3-4.05 2.3Zm0-8a3.241 3.241 0 0 0-2.78 4.92c.16.28.37.53.61.74.6.55 1.37.85 2.17.85 1.13 0 2.2-.6 2.78-1.57.17-.28.3-.6.37-.91.07-.26.1-.51.1-.77 0-.8-.3-1.57-.84-2.17-.6-.7-1.48-1.09-2.41-1.09Z",fill:r}),s.createElement("path",{d:"M19.498 18.73h-2.99c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h2.99c.41 0 .75.34.75.75s-.34.75-.75.75Z",fill:r}),s.createElement("path",{d:"M18 20.26c-.41 0-.75-.34-.75-.75v-2.99c0-.41.34-.75.75-.75s.75.34.75.75v2.99c0 .42-.34.75-.75.75Z",fill:r}))},Ce=function(n){var r=n.color;return s.createElement(s.Fragment,null,s.createElement("path",{d:"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",stroke:r,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{opacity:".4",d:"M3.41 22c0-3.87 3.85-7 8.59-7 .96 0 1.89.13 2.76.37",stroke:r,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),s.createElement("path",{d:"M22 18c0 .32-.04.63-.12.93-.09.4-.25.79-.46 1.13A3.97 3.97 0 0 1 18 22a3.92 3.92 0 0 1-2.66-1.03c-.3-.26-.56-.57-.76-.91A3.92 3.92 0 0 1 14 18a3.995 3.995 0 0 1 4-4c1.18 0 2.25.51 2.97 1.33.64.71 1.03 1.65 1.03 2.67ZM19.492 17.98h-2.98M18 16.52v2.99",stroke:r,strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}))},ke=function(n,r){switch(n){case"Bold":return s.createElement(je,{color:r});case"Broken":return s.createElement(fe,{color:r});case"Bulk":return s.createElement(ve,{color:r});case"Linear":return s.createElement(N,{color:r});case"Outline":return s.createElement(ye,{color:r});case"TwoTone":return s.createElement(Ce,{color:r});default:return s.createElement(N,{color:r})}},w=u.forwardRef(function(t,n){var r=t.variant,m=t.color,a=t.size,i=H(t,ge);return s.createElement("svg",K({},i,{xmlns:"http://www.w3.org/2000/svg",ref:n,width:a,height:a,viewBox:"0 0 24 24",fill:"none"}),ke(r,m))});w.propTypes={variant:b.oneOf(["Linear","Bold","Broken","Bulk","Outline","TwoTone"]),color:b.string,size:b.oneOfType([b.string,b.number])};w.defaultProps={variant:"Linear",color:"currentColor",size:"24"};w.displayName="UserAdd";function be({onEdit:t,onDelete:n,onAssignEmployees:r,onAssignUsers:m}){return[{id:"select",header:({table:a})=>e.jsx(V,{checked:a.getIsAllPageRowsSelected(),indeterminate:a.getIsSomePageRowsSelected(),onChange:i=>{a.getToggleAllPageRowsSelectedHandler()(i)},sx:{padding:0}}),cell:({row:a})=>e.jsx(V,{checked:a.getIsSelected(),disabled:!a.getCanSelect(),onChange:i=>{a.getToggleSelectedHandler()(i)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Código",accessorKey:"code",cell:({getValue:a})=>{const i=a();return e.jsx(h,{variant:"body2",sx:{fontWeight:600},children:i||"N/A"})}},{header:"Nombre",accessorKey:"name",cell:({row:a,getValue:i})=>{const p=i(),c=()=>t==null?void 0:t(a.original);return e.jsx(h,{variant:"body2",component:"a",onClick:c,sx:{color:"primary.main",textDecoration:"none",cursor:"pointer",fontWeight:500,"&:hover":{textDecoration:"underline"}},children:p||"N/A"})}},{header:"Descripción",accessorKey:"description",cell:({getValue:a})=>{const i=a();return e.jsx(h,{variant:"body2",sx:{maxWidth:300},noWrap:!0,children:i||"N/A"})}},{header:"Estado",accessorKey:"status",cell:({getValue:a})=>{const i=a();return e.jsx(E,{label:i?"Activo":"Inactivo",color:i?"success":"error",size:"small",variant:"light"})}},{header:"Fecha Creación",accessorKey:"createdAt",cell:({getValue:a})=>{const i=a();return i?new Date(i).toLocaleDateString("es-ES"):"N/A"}},{header:"Acciones",id:"actions",cell:({row:a})=>{const i=()=>t==null?void 0:t(a.original),p=()=>n==null?void 0:n(a.original),c=()=>r==null?void 0:r(a.original),f=()=>m==null?void 0:m(a.original);return e.jsxs(g,{direction:"row",spacing:.5,alignItems:"center",children:[r&&e.jsx(I,{title:"Asignar Empleados",children:e.jsx(A,{size:"small",color:"info",onClick:c,children:e.jsx($,{size:18})})}),m&&e.jsx(I,{title:"Asignar Usuarios",children:e.jsx(A,{size:"small",color:"secondary",onClick:f,children:e.jsx(w,{size:18})})}),t&&e.jsx(I,{title:"Editar",children:e.jsx(A,{size:"small",color:"primary",onClick:i,children:e.jsx(ce,{size:18})})}),n&&e.jsx(I,{title:"Eliminar",children:e.jsx(A,{size:"small",color:"error",onClick:p,children:e.jsx(F,{size:18})})})]})},enableSorting:!1,enableColumnFilter:!1,size:150}]}const Ee=({open:t,onClose:n,group:r})=>{const[m,a]=u.useState(!1),[i,p]=u.useState(""),{dialogState:c,openDialog:f,closeDialog:G}=O(),{users:M,usersLoading:U}=de(),{userCompanyVisitGroups:x,userCompanyVisitGroupsLoading:T,refreshUserCompanyVisitGroups:v}=me(r==null?void 0:r.id),k=()=>{p(""),n()},y=u.useMemo(()=>M.filter(o=>!x.some(d=>d.userId===o.id)),[M,x]),L=async()=>{if(!i){j({open:!0,message:"Seleccione un usuario",variant:"alert",alert:{color:"warning"}});return}a(!0);try{await ue(i,r.id),j({open:!0,message:"Usuario asignado exitosamente",variant:"alert",alert:{color:"success"}}),p(""),v&&v()}catch(o){j({open:!0,message:o.message||"Error al asignar usuario",variant:"alert",alert:{color:"error"}})}finally{a(!1)}},S=async o=>{const d=o.user,l=(d==null?void 0:d.fullName)||(d==null?void 0:d.userName)||"este usuario";f({title:"Desasignar Usuario",message:`¿Está seguro de desasignar al usuario "${l}"?`,severity:"warning",confirmText:"Desasignar",onConfirm:async()=>{a(!0);try{await he(o.id,r.id),j({open:!0,message:"Usuario desasignado exitosamente",variant:"alert",alert:{color:"success"}}),v&&v()}catch(R){j({open:!0,message:R.message||"Error al desasignar usuario",variant:"alert",alert:{color:"error"}})}finally{a(!1)}}})};return e.jsxs(q,{open:t,onClose:k,maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:"Asignar Usuarios al Grupo"}),e.jsx(Q,{children:e.jsxs(g,{spacing:3,sx:{mt:1},children:[e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Grupo: ",e.jsx("strong",{children:r==null?void 0:r.name})," (",r==null?void 0:r.code,")"]}),e.jsx(z,{}),e.jsxs(C,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Asignar Usuario"}),U?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(B,{})}):e.jsxs(g,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsxs(X,{fullWidth:!0,children:[e.jsx(pe,{id:"select-user-label",children:"Usuario"}),e.jsx(Y,{labelId:"select-user-label",id:"select-user",value:i,label:"Usuario",onChange:o=>p(o.target.value),disabled:m||y.length===0,children:y.length===0?e.jsx(Z,{value:"",children:e.jsx("em",{children:"No hay usuarios disponibles"})}):y.map(o=>e.jsx(Z,{value:o.id,children:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(h,{children:o.fullName||o.userName}),e.jsx(E,{label:o.email,size:"small",variant:"outlined"}),e.jsx(E,{label:o.role,size:"small",color:o.role==="Admin"?"primary":"default",variant:"light"})]})},o.id))})]}),e.jsx(D,{variant:"contained",startIcon:e.jsx(W,{}),onClick:L,disabled:m||!i,sx:{minWidth:120},children:"Asignar"})]})]}),e.jsx(z,{}),e.jsxs(C,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,children:["Usuarios Asignados (",x.length,")"]}),T?e.jsx(C,{display:"flex",justifyContent:"center",p:3,children:e.jsx(B,{})}):x.length===0?e.jsx(h,{variant:"body2",color:"text.secondary",children:"No hay usuarios asignados a este grupo"}):e.jsx(_,{children:x.map((o,d)=>{const l=o.user;return e.jsxs(s.Fragment,{children:[e.jsxs(ee,{sx:{border:1,borderColor:"divider",borderRadius:1,mb:1,bgcolor:"background.paper"},children:[e.jsx(re,{primary:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(h,{variant:"subtitle2",children:(l==null?void 0:l.fullName)||(l==null?void 0:l.userName)}),e.jsx(E,{label:l==null?void 0:l.email,size:"small",variant:"outlined"}),e.jsx(E,{label:l==null?void 0:l.role,size:"small",color:(l==null?void 0:l.role)==="Admin"?"primary":"default",variant:"light"})]}),secondary:e.jsxs(g,{spacing:.5,sx:{mt:.5},children:[e.jsxs(h,{variant:"caption",color:"text.secondary",children:["Estado: ",l!=null&&l.isActive?"Activo":"Inactivo"]}),e.jsxs(h,{variant:"caption",color:"text.secondary",children:["Asignado el: ",new Date(o.createdAt).toLocaleDateString("es-ES")]})]})}),e.jsx(se,{children:e.jsx(A,{edge:"end",color:"error",onClick:()=>S(o),disabled:m,children:e.jsx(F,{size:20})})})]}),d<x.length-1&&e.jsx(z,{})]},o.id)})})]})]})}),e.jsx(ae,{children:e.jsx(D,{onClick:k,disabled:m,children:"Cerrar"})}),e.jsx(P,{open:c.open,title:c.title,message:c.message,onConfirm:c.onConfirm,onCancel:G,confirmText:c.confirmText,cancelText:c.cancelText,severity:c.severity})]})},Ae=Ee;function Ne(){const t=te(),{selectedCompany:n}=ne(),r=n==null?void 0:n.companyId,{companyVisitGroups:m,companyVisitGroupsLoading:a,companyVisitGroupsError:i,refreshCompanyVisitGroups:p}=oe(r),{dialogState:c,openDialog:f,closeDialog:G}=O(),[M,U]=u.useState(null),[x,T]=u.useState(!1);u.useEffect(()=>{p&&p()},[p]);const v=u.useCallback(()=>{t("/apps/visits/groups/create")},[t]),k=u.useCallback(d=>{t(`/apps/visits/groups/edit/${d.id}`)},[t]),y=u.useCallback(async d=>{f({title:"Eliminar Grupo",message:`¿Está seguro de eliminar el grupo "${d.name}"? Esta acción no se puede deshacer.`,severity:"error",confirmText:"Eliminar",onConfirm:async()=>{try{await le(d.id,r),j({open:!0,message:"Grupo eliminado exitosamente",variant:"alert",alert:{color:"success"}})}catch(l){j({open:!0,message:l.message||"Error al eliminar el grupo",variant:"alert",alert:{color:"error"}})}}})},[r,f]),L=u.useCallback(d=>{t(`/apps/visits/groups/${d.id}/assign-employees`)},[t]),S=u.useCallback(d=>{U(d),T(!0)},[]),o=u.useMemo(()=>be({onEdit:k,onDelete:y,onAssignEmployees:L,onAssignUsers:S}),[k,y,L,S]);return a?e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(B,{})}):i?e.jsx(C,{sx:{p:3},children:e.jsx(h,{color:"error",children:"Error al cargar los grupos de visitas"})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{content:!1,children:e.jsxs(g,{spacing:3,sx:{p:3},children:[e.jsxs(g,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(h,{variant:"h5",children:"Grupos de Visitas"}),e.jsx(D,{variant:"contained",size:"small",startIcon:e.jsx(W,{}),onClick:v,sx:{fontWeight:600},children:"Nuevo Grupo"})]}),e.jsx(xe,{data:m||[],columns:o,filterOnHeaderVisible:!0,enableRowSelection:!0,tableId:"companyVisitGroupsTable",tableNowrap:!0})]})}),e.jsx(Ae,{open:x,group:M,onClose:()=>T(!1)}),e.jsx(P,{open:c.open,title:c.title,message:c.message,severity:c.severity,confirmText:c.confirmText,cancelText:c.cancelText,onConfirm:c.onConfirm,onCancel:G})]})}export{Ne as default};
