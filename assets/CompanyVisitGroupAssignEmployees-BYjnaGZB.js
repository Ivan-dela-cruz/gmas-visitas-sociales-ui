import{j as s,C as A,k as n,r as x,A as u,S as G,F as z,X as V,B as y,O as K,N as P,w as F,y as L,M as k}from"./index-8i2qIeC5.js";import{B as D}from"./index-iPnnsK5M.js";import{u as B,T as H,C as O}from"./useConfirmDialog-BqEGclvE.js";import{C as v}from"./Checkbox-CUgLVUIU.js";import{u as $,a as M,b as W,c as U}from"./employeeCompanyVisitGroups-Csb7eRwx.js";import{A as q}from"./ArrowLeft-D7tqb4HZ.js";import{C as T}from"./CircularProgress-Ba8lmjXM.js";import{a as X}from"./companyVisitGroups-C4kYmZfl.js";import"./TextField-hsc-s2X2.js";import"./InputLabel-BPE1mrZ-.js";import"./FormHelperText-DxDomcnh.js";function J(){return[{id:"select",header:({table:e})=>s.jsx(v,{checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:a=>{e.getToggleAllPageRowsSelectedHandler()(a)},sx:{padding:0}}),cell:({row:e})=>s.jsx(v,{checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:a=>{e.getToggleSelectedHandler()(a)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Id",accessorKey:"id",cell:({getValue:e})=>s.jsx(A,{label:e()||"N/A",size:"small",color:"primary",variant:"light"}),size:100,defaultIsVisible:!1},{header:"Código",accessorKey:"codeEmployee",cell:({getValue:e})=>s.jsx(A,{label:e()||"N/A",size:"small",color:"primary",variant:"light"}),size:100},{header:"Identificación",accessorKey:"employeeIdentification",cell:({getValue:e})=>s.jsx(n,{variant:"body2",children:e()||"N/A"})},{header:"Nombres",accessorKey:"employeeFirstName",cell:({getValue:e})=>s.jsx(n,{variant:"body2",sx:{fontWeight:500},children:e()||"N/A"})},{header:"Apellidos",accessorKey:"employeeLastName",cell:({getValue:e})=>s.jsx(n,{variant:"body2",sx:{fontWeight:500},children:e()||"N/A"})},{header:"Estado",accessorKey:"status",cell:({getValue:e})=>s.jsx(A,{label:e()?"Activo":"Inactivo",color:e()?"success":"error",size:"small",variant:"light"}),size:100}]}function Q(){return[{id:"select",header:({table:e})=>s.jsx(v,{checked:e.getIsAllPageRowsSelected(),indeterminate:e.getIsSomePageRowsSelected(),onChange:a=>{e.getToggleAllPageRowsSelectedHandler()(a)},sx:{padding:0}}),cell:({row:e})=>s.jsx(v,{checked:e.getIsSelected(),disabled:!e.getCanSelect(),onChange:a=>{e.getToggleSelectedHandler()(a)},sx:{padding:0}}),enableColumnFilter:!1,enableSorting:!1,enableHiding:!1,size:50,meta:{skipFilter:!0}},{header:"Código",accessorKey:"employeeCompany.codeEmployee",cell:({row:e})=>{var a;return s.jsx(A,{label:((a=e.original.employeeCompany)==null?void 0:a.codeEmployee)||"N/A",size:"small",color:"primary"})},size:100},{header:"Identificación",accessorKey:"employeeCompany.employeeIdentification",cell:({row:e})=>{var a,l,i;return s.jsx(n,{variant:"body2",children:((a=e.original.employeeCompany)==null?void 0:a.employeeIdentification)||((i=(l=e.original.employeeCompany)==null?void 0:l.employee)==null?void 0:i.identification)||"N/A"})}},{header:"Nombres",accessorKey:"employeeCompany.employeeFirstName",cell:({row:e})=>{var a;return s.jsx(n,{variant:"body2",sx:{fontWeight:500},children:((a=e.original.employeeCompany)==null?void 0:a.employeeFirstName)||"N/A"})}},{header:"Apellidos",accessorKey:"employeeCompany.employeeLastName",cell:({row:e})=>{var a;return s.jsx(n,{variant:"body2",sx:{fontWeight:500},children:((a=e.original.employeeCompany)==null?void 0:a.employeeLastName)||"N/A"})}},{header:"Teléfono",accessorKey:"employeeCompany.employee.cellphoneNumber",cell:({row:e})=>{var a,l;return s.jsx(n,{variant:"body2",children:((l=(a=e.original.employeeCompany)==null?void 0:a.employee)==null?void 0:l.cellphoneNumber)||"N/A"})}},{header:"Fecha Asignación",accessorKey:"createdAt",cell:({getValue:e})=>{const a=e();return a?new Date(a).toLocaleDateString("es-ES"):"N/A"},size:120}]}function Y(e,a){const[l,i]=x.useState(!1),[r,d]=x.useState({}),[m,p]=x.useState({}),{dialogState:S,openDialog:E,closeDialog:w}=B(),{employeeCompanies:f,employeeCompaniesLoading:I,refreshEmployeeCompanies:g}=$(a),{employeeCompanyVisitGroups:t,employeeCompanyVisitGroupsLoading:N,refreshEmployeeCompanyVisitGroups:h}=M(e==null?void 0:e.id),R=x.useMemo(()=>e?f.filter(c=>!t.some(o=>o.employeeCompanyId===c.id)):[],[e,f,t]);return{loading:l,selectedRows:r,selectedAssignedRows:m,availableEmployees:R,employeeCompanyVisitGroups:t,employeeCompaniesLoading:I,employeeCompanyVisitGroupsLoading:N,handleAssign:async()=>{const c=Object.keys(r).filter(o=>r[o]);if(c.length===0){u({open:!0,message:"Seleccione al menos un empleado",variant:"alert",alert:{color:"warning"}});return}i(!0);try{await W(c,e.id);const o=[];h&&o.push(h()),g&&o.push(g()),await Promise.all(o),d({}),u({open:!0,message:`${c.length} empleado(s) asignado(s) exitosamente`,variant:"alert",alert:{color:"success"}})}catch(o){u({open:!0,message:o.message||"Error al asignar empleados",variant:"alert",alert:{color:"error"}})}finally{i(!1)}},handleUnassign:async()=>{const c=Object.keys(m).filter(o=>m[o]);if(c.length===0){u({open:!0,message:"Seleccione al menos un empleado",variant:"alert",alert:{color:"warning"}});return}E({title:"Confirmar desasignación",message:`¿Está seguro que desea desasignar ${c.length} empleado(s)?`,severity:"warning",confirmText:"Desasignar",onConfirm:async()=>{i(!0);try{await U(c,e.id);const o=[];h&&o.push(h()),g&&o.push(g()),await Promise.all(o),p({}),u({open:!0,message:`${c.length} empleado(s) desasignado(s) exitosamente`,variant:"alert",alert:{color:"success"}})}catch(o){u({open:!0,message:o.message||"Error al desasignar empleados",variant:"alert",alert:{color:"error"}})}finally{i(!1)}}})},setSelectedRows:d,setSelectedAssignedRows:p,clearSelections:()=>{d({}),p({})},dialogState:S,closeDialog:w}}function Z({group:e,companyId:a,onBack:l}){const{loading:i,selectedRows:r,selectedAssignedRows:d,availableEmployees:m,employeeCompanyVisitGroups:p,employeeCompaniesLoading:S,employeeCompanyVisitGroupsLoading:E,handleAssign:w,handleUnassign:f,setSelectedRows:I,setSelectedAssignedRows:g,dialogState:t,closeDialog:N}=Y(e,a),h=x.useMemo(()=>J(),[]),R=x.useMemo(()=>Q(),[]),C=Object.keys(r).filter(b=>r[b]).length,j=Object.keys(d).filter(b=>d[b]).length;return s.jsxs(s.Fragment,{children:[s.jsxs(G,{spacing:3,children:[s.jsx(G,{direction:"row",alignItems:"center",justifyContent:"space-between",children:s.jsxs(G,{direction:"row",alignItems:"center",spacing:2,children:[s.jsx(z,{variant:"outlined",size:"small",startIcon:s.jsx(q,{}),onClick:l,children:"Volver a Grupos"}),s.jsx(n,{variant:"h5",children:"Asignar Empleados al Grupo"})]})}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:["Grupo: ",s.jsx("strong",{children:e==null?void 0:e.name})," (",e==null?void 0:e.code,")"]}),s.jsx(V,{}),s.jsxs(y,{children:[s.jsx(n,{variant:"h6",sx:{mb:2},children:"Empleados Disponibles"}),S?s.jsx(y,{display:"flex",justifyContent:"center",p:3,children:s.jsx(T,{})}):m.length===0?s.jsx(n,{variant:"body2",color:"text.secondary",children:"No hay empleados disponibles para asignar"}):s.jsx(D,{toolbarButtons:[{label:`Asignar Seleccionados (${C})`,icon:s.jsx(K,{}),toolTip:`Asignar ${C} empleado(s) seleccionado(s)`,variant:"contained",onClick:w,disabled:C===0||i}],data:m,columns:h,enableRowSelection:!0,filterOnHeaderVisible:!0,tableId:"assignEmployeesTable",onRowSelectionChange:I,rowSelection:r,isDownload:!1})]}),s.jsx(V,{}),s.jsxs(y,{children:[s.jsx(n,{variant:"h6",sx:{mb:2},children:"Empleados Asignados"}),E?s.jsx(y,{display:"flex",justifyContent:"center",p:3,children:s.jsx(T,{})}):p.length===0?s.jsx(n,{variant:"body2",color:"text.secondary",children:"No hay empleados asignados a este grupo"}):s.jsx(D,{toolbarButtons:[{label:`Desasignar Seleccionados (${j})`,icon:s.jsx(H,{}),toolTip:`Desasignar ${j} empleado(s) seleccionado(s)`,variant:"contained",color:"error",onClick:f,disabled:j===0||i}],data:p,columns:R,enableRowSelection:!0,filterOnHeaderVisible:!0,tableId:"assignedEmployeesTable",onRowSelectionChange:g,rowSelection:d,isDownload:!1})]})]}),s.jsx(O,{open:t.open,title:t.title,message:t.message,severity:t.severity,confirmText:t.confirmText,cancelText:t.cancelText,onConfirm:t.onConfirm,onCancel:N})]})}function de(){const{id:e}=P(),a=F(),{selectedCompany:l}=L(),i=l==null?void 0:l.companyId,{companyVisitGroup:r,companyVisitGroupLoading:d,companyVisitGroupError:m}=X(e),p=()=>{a("/apps/visits/groups/list")};return d?s.jsx(k,{content:!1,children:s.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:s.jsx(T,{})})}):m||!r?s.jsx(k,{content:!1,children:s.jsx(y,{sx:{p:3},children:s.jsx(n,{color:"error",children:"Error al cargar el grupo de visitas"})})}):s.jsx(k,{content:!1,children:s.jsx(y,{sx:{p:3},children:s.jsx(Z,{group:r,companyId:i,onBack:p})})})}export{de as default};
